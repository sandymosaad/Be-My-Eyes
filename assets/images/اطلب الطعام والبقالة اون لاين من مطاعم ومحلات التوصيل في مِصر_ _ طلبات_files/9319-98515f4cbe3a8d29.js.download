"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9319],{9319:function(e,r,t){t.r(r),t.d(r,{RateOrderlModal:function(){return A}});var a=t(47568),n=t(26042),s=t(69396),i=t(828),d=t(20414),l=t(85893),c=t(67294),o=t(33763),u=t(69553),m=t(7297),g=t(87379);function R(){var e=(0,m.Z)(["\n  .image-container {\n    width: 70px;\n    height: 70px;\n  }\n\n  .rating-header-border {\n    margin-inline-start: -15px;\n    margin-inline-end: -15px;\n  }\n\n  :dir(rtl) {\n    .rating-comp {\n      -webkit-transform: scaleX(-1);\n      transform: scaleX(-1);\n    }\n  }\n\n  .rating-comp {\n    margin-block-start: auto;\n  }\n\n  .success-img {\n    height: 23px;\n    width: 23px;\n  }\n\n  .ratings-section {\n    label {\n      max-width: 50%;\n    }\n  }\n"]);return R=function(){return e},e}var h=g.ZP.div.withConfig({componentId:"sc-7514cbe3-0"})(R()),f=t(36911),x=t(64298),v=t(38145),p=function(e){var r=e.ratingValue,t=e.canEdit,a=e.label,n=e.elementRef,s=e.setVal,i=e.name,d=e.fullStars,c=e.showLabel,o=e.handleChange,u=function(e){s(i,e,{shouldDirty:!0}),o&&o(e)};return(0,l.jsxs)("div",{className:"form-row mb-2 justify-content-between align-items-center",children:[(0,l.jsx)("label",{className:"dark-gray mb-0",children:a}),(0,l.jsx)("input",{ref:n,type:"hidden",name:i}),(0,l.jsx)(v.A,{ratingValue:r,canEdit:t,onChange:u,fullStars:d,showLabel:c,name:i})]})},b=t(39380),E=t(85110),j=t(59253),O={UPDATE_RATE_ORDER_INFO:"UPDATE_RATE_ORDER_INFO",UPDATE_RATE_ORDER_SUCCESS:"UPDATE_RATE_ORDER_SUCCESS",UPDATE_DRIVER_RATING:"UPDATE_DRIVER_RATING",SELECT_DRIVER_TAGS:"SELECT_DRIVER_TAGS",SET_DRIVER_ERROR:"SET_DRIVER_ERROR"},_=t(29815),N={isratingSuccess:!1,isLoading:!0,selectedOrder:null,driverRating:0,selectedDrtIds:[],driverRatingError:""},y=function(e,r){switch(r.type){case O.UPDATE_RATE_ORDER_INFO:return(0,s.Z)((0,n.Z)({},e),{isLoading:!1,selectedOrder:r.payload});case O.UPDATE_RATE_ORDER_SUCCESS:return(0,s.Z)((0,n.Z)({},e),{isratingSuccess:!0});case O.UPDATE_DRIVER_RATING:return(0,s.Z)((0,n.Z)({},e),{selectedDrtIds:[],driverRating:r.payload});case O.SET_DRIVER_ERROR:return(0,s.Z)((0,n.Z)({},e),{driverRatingError:r.payload});case O.SELECT_DRIVER_TAGS:var t=(0,_.Z)(e.selectedDrtIds);return r.payload.checked?t.push(r.payload.id):t=t.filter(function(e){return r.payload.id!==e}),(0,s.Z)((0,n.Z)({},e),{selectedDrtIds:t,driverRatingError:""});default:return e}},D=t(18334);function S(){var e=(0,m.Z)(["\n  input {\n    appearance: none;\n  }\n\n  input:checked + .label-tag {\n    color: ",";\n    background-color: ",";\n    border-color: ",";\n  }\n  input:disabled + .label-tag {\n    cursor: not-allowed;\n    opacity: 0.65;\n    box-shadow: none;\n  }\n  .label-tag {\n    border-radius: 15px;\n    border: 1px solid ",";\n    position: relative;\n    overflow: hidden;\n    color: ",";\n\n    &:hover {\n      color: ",";\n      background-color: ",";\n      border-color: ",";\n    }\n  }\n"]);return S=function(){return e},e}var T=g.ZP.div.withConfig({componentId:"sc-ce12641f-0"})(S(),D.eB.white,D.eB.primary.main,D.eB.primary.main,D.eB.ratingTag.borderColor,D.eB.ratingTag.textColor,D.eB.white,D.eB.primary.main,D.eB.primary.main),I=function(e){var r=e.name,t=e.dataArray,a=e.canEdit,n=e.defaultSelected,s=e.selectedValues;return(0,l.jsx)(T,{children:(0,l.jsx)("div",{className:"form-row flex-wrap mb-2",children:t.map(function(e){return(0,l.jsxs)(c.Fragment,{children:[(0,l.jsx)("input",{type:"checkbox",name:r,value:e.id,id:e.id,readOnly:a,disabled:a,defaultChecked:n.includes(e.id),onChange:function(r){return s(e.id,r.target.checked)}}),(0,l.jsx)("label",{"data-testid":"label-tag",className:"label-tag py-1 px-2 mr-1 f-12 mb-2 clickable d-block",htmlFor:e.id,children:e.tagText})]},e.id)})})})},A=function(e){var r,t,m,g,R=e.showModal,v=e.handleClose,_=e.orderID,D=(0,u.$G)().t,S=(0,x.cI)({mode:"onBlur"}),T=S.handleSubmit,A=S.register,C=S.errors,w=S.setValue,V=(0,i.Z)(c.useReducer(y,N),2),Z=V[0],k=V[1];(0,c.useEffect)(function(){P()},[]);var U,P=(g=(0,a.Z)(function(){var e,r,t;return(0,d.__generator)(this,function(a){switch(a.label){case 0:return[4,b.Z.getSingleOrder(_)];case 1:return r=(e=a.sent()).baseUrl,t=e.result,k({type:O.UPDATE_RATE_ORDER_INFO,payload:(0,f.UK)(t,r)}),[2]}})}),function(){return g.apply(this,arguments)}),L=function(e){k({type:O.UPDATE_DRIVER_RATING,payload:e})},F=(U=(0,a.Z)(function(e){var r,t;return(0,d.__generator)(this,function(t){switch(t.label){case 0:if(e.driverRating&&0===Z.selectedDrtIds.length)return k({type:O.SET_DRIVER_ERROR,payload:D("myAccount:driver_rating_require_message.translation")}),[2];return r=(0,s.Z)((0,n.Z)({},e),{ItemsRating:0,OrdId:Z.selectedOrder.orderID,idre:!1,idrm:!1,selectedDrtIds:Z.selectedDrtIds}),[4,b.Z.rateOrder(r,Z.selectedOrder.orderID)];case 1:return 0==t.sent().result.rst.statusCode&&(k({type:O.UPDATE_RATE_ORDER_SUCCESS}),E.Z.orderRatingSubmitted(Z.selectedOrder.orderID)),[2]}})}),function(e){return U.apply(this,arguments)});return(0,l.jsxs)(o.Z,{show:R,onHide:v,dialogClassName:"rate-order-modal",centered:!0,children:[(0,l.jsxs)(o.Z.Header,{className:"f-small d-flex b-b py-2 px-3 bg-header-alert",children:[(0,l.jsx)(o.Z.Title,{children:(0,l.jsx)("span",{className:"f-20 f-m-17 color-primary f-500",children:D("common:rateOrder.translation")})}),(0,l.jsx)("span",{className:"clickable close-span","data-testid":"close-modal",children:(0,l.jsx)("img",{onClick:v,src:"/assets/images/search-close.svg",alt:"close"})})]}),(0,l.jsxs)(o.Z.Body,{children:[Z.isLoading&&(0,l.jsx)("div",{className:"d-flex d-flex justify-content-center align-items-center spinner-container",children:(0,l.jsx)(j.$,{justSpinner:!0})}),!Z.isLoading&&(0,l.jsx)(h,{"data-testid":"rate-order-component",children:Z.isratingSuccess?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"f-16 f-500 green-text pa-2 mb-1 mt-2 text-center",children:[(0,l.jsx)("img",{className:"success-img mr-2",src:"/assets/images/success-circle.svg",alt:"Success Circle"}),D("ratingSubmitted.translation")]}),(0,l.jsx)("div",{className:"text-center mb-2 dark-gray",children:D("talabatModeration.translation")})]}):Z.selectedOrder.canRate?(0,l.jsxs)("div",{className:"rating-available",children:[(0,l.jsx)("div",{className:"order-details pa-2 mt-2",children:(0,l.jsxs)("div",{className:"media",children:[(0,l.jsx)("div",{className:"image-container mr-2 pa-2 b-radius-3 b-a",children:(0,l.jsx)("img",{className:"align-self-start restaurant-icon w-100 h-100",src:Z.selectedOrder.restaurantLogo,alt:Z.selectedOrder.restaurantName})}),(0,l.jsxs)("div",{className:"media-body",children:[(0,l.jsx)("div",{className:"media-heading f-16 mb-1 primary-text",children:Z.selectedOrder.restaurantName}),(0,l.jsxs)("div",{className:"status-div",children:[(0,l.jsxs)("span",{className:"f-600",children:[D("common:status.translation")," "]}),(0,l.jsx)("span",{className:Z.selectedOrder.orderDetails.orderStatus?"green-text":"red-text",children:D((0,f.yW)(Z.selectedOrder.enhancedOrderStatus,Z.selectedOrder.orderDetails.isOrderSuccessfull))})]}),(0,l.jsxs)("div",{className:"status-div",children:[(0,l.jsxs)("span",{className:"f-600",children:[D("common:orderDate.translation")," "]}),(0,l.jsx)("span",{children:Z.selectedOrder.orderDetails.orderCreatedTime})]})]})]})}),(0,l.jsx)("div",{className:"rating-heading pa-2 bg-light-grey text-center",children:Z.selectedOrder.isRatingSubmitted?(0,l.jsxs)("div",{className:"f-14 f-500 green-text",children:[(0,l.jsx)("img",{className:"success-img mr-2",src:"/assets/images/success-circle.svg",alt:"Success Circle"}),D("ratingSubmitted.translation")]}):(0,l.jsx)("span",{className:"f-14 f-500",children:D("giveRating.translation")})}),(0,l.jsx)("div",{className:"ratings-section px-2 pt-3",children:(0,l.jsxs)("form",{action:"",className:"px-3",children:[(0,l.jsxs)("div",{className:"f-16 text-center f-500 mb-2",children:[D("restaurantRating.translation")," ",(0,l.jsx)("sup",{className:"error f-600",children:"*"})]}),(0,l.jsx)(p,{ratingValue:Z.selectedOrder.restaurantRatingInfo.packageRating,elementRef:A({required:!0}),setVal:w,label:D("restaurantRating_orderPackaging.translation"),canEdit:!Z.selectedOrder.isRatingSubmitted,name:"PackageRating"}),(0,l.jsx)(p,{ratingValue:Z.selectedOrder.restaurantRatingInfo.deliveryTimeRating,label:D("restaurantRating_deliveryTime.translation"),canEdit:!Z.selectedOrder.isRatingSubmitted,elementRef:A({required:!0}),setVal:w,name:"DeliveryRating"}),(0,l.jsx)(p,{ratingValue:Z.selectedOrder.restaurantRatingInfo.valueForMoneyRating,label:D("restaurantRating_valueForMoney.translation"),canEdit:!Z.selectedOrder.isRatingSubmitted,elementRef:A({required:!0}),setVal:w,name:"ValueRating"}),(0,l.jsxs)("div",{className:"f-16 text-center f-500 mb-2 pt-2 b-t rating-header-border",children:[D("qualityOfFood.translation")," ",(0,l.jsx)("sup",{className:"error f-600",children:"*"})]}),Z.selectedOrder.orderedItems.map(function(e,r){return(0,l.jsxs)(c.Fragment,{children:[(0,l.jsx)(p,{ratingValue:e.rating,label:e.itemName,canEdit:!Z.selectedOrder.isRatingSubmitted,elementRef:A({required:!0}),setVal:w,name:"items[".concat(r,"]Rating")}),(0,l.jsx)("input",{ref:A,type:"hidden",value:e.itemID,name:"items[".concat(r,"]ItemId")})]},e.itemID)}),Z.selectedOrder.isDriverRatingEnabled&&(0,l.jsxs)("div",{className:"driver-rating-section",children:[(0,l.jsxs)("div",{className:"f-14 text-center f-500 mb-2 pt-2 b-t rating-header-border",children:[D("driverRating.translation")," ",Z.selectedOrder.isDriverRatingMandatory&&(0,l.jsx)("sup",{className:"error f-600",children:"*"})]}),(0,l.jsx)(p,{ratingValue:Z.selectedOrder.driverRating,label:D("driverRating_performance.translation"),canEdit:!Z.selectedOrder.isRatingSubmitted,elementRef:A({required:Z.selectedOrder.isDriverRatingMandatory}),setVal:w,showLabel:!0,name:"driverRating",handleChange:L,fullStars:!0}),((null==Z?void 0:Z.driverRating)>0||(null==Z?void 0:null===(r=Z.selectedOrder)||void 0===r?void 0:r.driverRating)>0)&&(0,l.jsx)(I,{canEdit:0!==Z.selectedOrder.driverRating,name:"selectedDrtIds",dataArray:(null===(m=null==Z?void 0:null===(t=Z.selectedOrder)||void 0===t?void 0:t.driverRatingTags[Z.driverRating-1])||void 0===m?void 0:m.tags)||Z.selectedOrder.driverRatingTags.find(function(e){return e.rating===Z.selectedOrder.driverRating}).tags,defaultSelected:Z.selectedOrder.selectedDriverRatingTagIds,selectedValues:function(e,r){return k({type:O.SELECT_DRIVER_TAGS,payload:{id:e,checked:r}})}})]}),(0,l.jsx)("div",{className:"f-14 text-center f-500 mb-2 pt-2 b-t rating-header-border",children:D("reviewAboutOrder.translation")}),(0,l.jsx)("textarea",{name:"review",ref:A(),className:"form-control",readOnly:Z.selectedOrder.isRatingSubmitted,defaultValue:Z.selectedOrder.orderReview}),Object.keys(C).length>0&&(0,l.jsx)("div",{className:"mt-2 text-center error","data-testid":"rate-error",children:D("rateAllFields.translation")}),Z.driverRatingError&&(0,l.jsx)("div",{className:"mt-2 text-center error","data-testid":"driver-rate-error",children:Z.driverRatingError})]})})]}):(0,l.jsxs)("div",{className:"rating-unavailable mt-6 text-center",children:[(0,l.jsx)("img",{className:"mt-2",src:"/assets/images/img_rate.png",alt:"Rating Unavailable"}),(0,l.jsx)("div",{className:"mt-2 mb-10 f-22",children:Z.selectedOrder.message})]})})]}),!Z.isratingSuccess&&!Z.isLoading&&(0,l.jsxs)(o.Z.Footer,{children:[(0,l.jsx)("button",{className:"btn btn-secondary-outline px-6 text-uppercase",onClick:v,children:D("cancel.translation")}),Z.selectedOrder&&!Z.selectedOrder.isRatingSubmitted&&Z.selectedOrder.canRate&&(0,l.jsx)("button",{"data-testid":"rate-cta-btn",className:"btn btn-secondary px-6 text-uppercase",onClick:T(function(e){return F(e)}),children:D("myAccount:submit.translation")})]})]})}},38145:function(e,r,t){t.d(r,{A:function(){return g}});var a=t(85893),n=t(36911),s=t(18334),i=t(69553),d=t(67294),l=t(11312),c=t(7297),o=t(87379);function u(){var e=(0,c.Z)(["\n  .react-stars {\n    ","\n\n    span {\n      &::before {\n        ","\n      }\n    }\n  }\n"]);return u=function(){return e},e}var m=o.ZP.div.withConfig({componentId:"sc-f97fa212-0"})(u(),function(e){return e.theme.isRTL?"transform: rotateY(180deg);":null},function(e){return e.theme.isRTL?"transform: rotateY(180deg);":null}),g=function(e){var r=e.ratingValue,t=e.canEdit,c=e.onChange,o=e.fullStars,u=e.showLabel,g=e.size,R=(0,i.$G)().t,h=(0,d.useState)(""),f=h[0],x=h[1],v=(0,d.useState)(r),p=v[0],b=v[1];(0,d.useEffect)(function(){b(r)},[r]);var E=function(e){u&&x((0,n.t2)(e)),c&&c(e)};return(0,a.jsxs)(m,{"data-testid":"rating-component",children:[""!=f&&(0,a.jsxs)("div",{className:"ml-auto mr-1 dark-gray",children:["(",R(f),")"]}),(0,a.jsx)(l.Z,{count:5,onChange:E,edit:t,size:g||24,isHalf:!o,value:p,color:s.eB.neutralGrey.shade10,activeColor:s.eB.primary.main,className:"rating-comp"})]})}}}]);